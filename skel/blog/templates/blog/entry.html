{% load comments tagging_tags comments_tags %}

{% get_comment_count for entry as comment_count %}
{% tags_for_object entry as tags %}

<div class="entry">

    <p class="meta">
        Author:
        <a href="{% url accounts:user entry.author %}">{% firstof entry.author.get_full_name entry.author.username %}</a><br />
        <abbr title="{{ entry.published|date:"Y-m-dTH:i:sQ" }}">{{ entry.published|date:"F jS Y g:i a"|safe }}</abbr><br />
        Tags:
    {% for tag in tags %}
        <a href="{% url blog:tag tag.name %}">{{ tag.name }}</a>{% if not forloop.last %},{% endif %}
    {% endfor %}
    
    {% if entry.categories.all %}
        <br />
        Categories:
        {% for category in entry.categories.all %}
            <a href="{% url blog:category category.slug %}" rel="tag">{{ category.name }}</a>{% if not forloop.last %},{% endif %}
        {% endfor %}
    {% endif %}
    </p>

{% if not show_detail %}
    {% if entry.summary_markedup.rendered %}
        {{ entry.summary_markedup.rendered|safe }}
    {% else %}
        <p>{{ entry.summary }}</p>
    {% endif %}
    <p class="meta"><a href="{{ entry.get_absolute_url }}#comments">Comments ({{ comment_count }})</a></p>
    <p><a href="{{ entry.get_absolute_url }}" class="button-right">Read more</a></p>
    
{% else %}
    {% if entry.body_markedup.rendered %}
        {{ entry.body_markedup.rendered|safe }}
    {% else %}
        <p>{{ entry.body }}</p>
    {% endif %}
    
    {% render_comment_list for entry %}

    {% if entry.comments_enabled %}
        <h2>Leave a Comment</h2>
        {% with entry.get_absolute_url as next %}
            {% render_comment_form for entry %}
        {% endwith %}
    {% else %}
        <p>Comments are disabled for this entry.</p>
    {% endif %}
{% endif %}

</div>
